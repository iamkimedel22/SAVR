{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/expense-tracker-web-app/lib/auth.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\"\nimport type { NextRequest } from \"next/server\"\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-secret-key-change-in-production\"\n\nexport function generateToken(userId: number) {\n  return jwt.sign({ userId }, JWT_SECRET, { expiresIn: \"7d\" })\n}\n\nexport function verifyToken(token: string) {\n  try {\n    return jwt.verify(token, JWT_SECRET) as { userId: number }\n  } catch {\n    return null\n  }\n}\n\nexport function getAuthToken(request: NextRequest) {\n  const authHeader = request.headers.get(\"authorization\")\n  if (!authHeader?.startsWith(\"Bearer \")) {\n    return null\n  }\n  return authHeader.slice(7)\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,cAAc,MAAc;IAC1C,OAAO,kJAAG,CAAC,IAAI,CAAC;QAAE;IAAO,GAAG,YAAY;QAAE,WAAW;IAAK;AAC5D;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,aAAa,OAAoB;IAC/C,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IACA,OAAO,WAAW,KAAK,CAAC;AAC1B"}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/expense-tracker-web-app/lib/db.ts"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\nconst pool = mysql.createPool({\n  host: process.env.MYSQL_HOST || \"localhost\",\n  user: process.env.MYSQL_USER || \"root\",\n  password: process.env.MYSQL_PASSWORD || \"\",\n  database: process.env.MYSQL_DATABASE || \"savr\",\n  port: Number(process.env.MYSQL_PORT || 3306),\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n})\n\nexport async function executeQuery(query: string, values?: any[]) {\n  try {\n    const connection = await pool.getConnection()\n    const [results] = await connection.execute(query, values)\n    connection.release()\n    return results\n  } catch (error) {\n    console.error(\"Database error:\", error)\n    throw error\n  }\n}\n\nexport default pool\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;IAChC,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;IAChC,UAAU,QAAQ,GAAG,CAAC,cAAc,IAAI;IACxC,UAAU,QAAQ,GAAG,CAAC,cAAc,IAAI;IACxC,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;IACvC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEO,eAAe,aAAa,KAAa,EAAE,MAAc;IAC9D,IAAI;QACF,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,OAAO,CAAC,OAAO;QAClD,WAAW,OAAO;QAClB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,MAAM;IACR;AACF;uCAEe"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/expense-tracker-web-app/app/api/budgets/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { verifyToken, getAuthToken } from \"@/lib/auth\"\nimport { executeQuery } from \"@/lib/db\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const token = getAuthToken(request)\n    if (!token) {\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ message: \"Invalid token\" }, { status: 401 })\n    }\n\n    const userId = decoded.userId\n\n    const budgets = await executeQuery(\n      `SELECT b.*, c.name as category_name, \n              COALESCE(SUM(t.amount), 0) as spent \n       FROM budgets b \n       LEFT JOIN categories c ON b.category_id = c.id \n       LEFT JOIN transactions t ON t.category_id = b.category_id \n         AND t.user_id = ? \n         AND t.type = 'expense'\n         AND MONTH(t.date) = MONTH(b.month)\n         AND YEAR(t.date) = YEAR(b.month)\n       WHERE b.user_id = ?\n       GROUP BY b.id`,\n      [userId, userId],\n    )\n\n    // Map rows to the expected client shape\n    const mapped = Array.isArray(budgets)\n      ? budgets.map((b: any) => {\n          const amount = Number.parseFloat(b.amount ?? 0) || 0\n          const spent = Number.parseFloat(b.spent ?? 0) || 0\n          const percentage = amount > 0 ? Math.round((spent / amount) * 100) : 0\n          return {\n            id: b.id,\n            category: b.category_name || \"Other\",\n            amount,\n            spent,\n            percentage: Math.min(percentage, 100),\n          }\n        })\n      : []\n\n    return NextResponse.json(mapped)\n  } catch (error) {\n    console.error(\"[v0] Get budgets error:\", error)\n    return NextResponse.json({ message: \"Internal server error\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const token = getAuthToken(request)\n    if (!token) {\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return NextResponse.json({ message: \"Invalid token\" }, { status: 401 })\n    }\n\n    const userId = decoded.userId\n\n    const { category, categoryId, month, amount } = await request.json()\n\n    if (!amount || (!category && !categoryId)) {\n      return NextResponse.json({ message: \"Missing required fields\" }, { status: 400 })\n    }\n\n    let resolvedCategoryId = categoryId ?? null\n    if (!resolvedCategoryId && category) {\n      const categoryResult = await executeQuery(\n        \"SELECT id FROM categories WHERE name = ? AND (user_id = ? OR user_id IS NULL)\",\n        [category, userId],\n      )\n      resolvedCategoryId = Array.isArray(categoryResult) && categoryResult[0] ? (categoryResult[0] as any).id : null\n    }\n\n    const insertMonth = month || new Date().toISOString().slice(0, 10)\n    const result = await executeQuery(\n      \"INSERT INTO budgets (user_id, category_id, month, amount) VALUES (?, ?, ?, ?)\",\n      [userId, resolvedCategoryId, insertMonth, Number.parseFloat(amount)],\n    )\n\n    return NextResponse.json({ message: \"Budget created\", id: (result as any).insertId }, { status: 201 })\n  } catch (error) {\n    console.error(\"[v0] Create budget error:\", error)\n    return NextResponse.json({ message: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}