{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/SAVR/lib/auth.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\"\r\nimport type { NextRequest } from \"next/server\"\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-secret-key-change-in-production\"\r\n\r\nexport function generateToken(userId: number) {\r\n  return jwt.sign({ userId }, JWT_SECRET, { expiresIn: \"7d\" })\r\n}\r\n\r\nexport function verifyToken(token: string) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET) as { userId: number }\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nexport function getAuthToken(request: NextRequest) {\r\n  const authHeader = request.headers.get(\"authorization\")\r\n  if (!authHeader?.startsWith(\"Bearer \")) {\r\n    return null\r\n  }\r\n  return authHeader.slice(7)\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,cAAc,MAAc;IAC1C,OAAO,kJAAG,CAAC,IAAI,CAAC;QAAE;IAAO,GAAG,YAAY;QAAE,WAAW;IAAK;AAC5D;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,aAAa,OAAoB;IAC/C,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,WAAW,YAAY;QACtC,OAAO;IACT;IACA,OAAO,WAAW,KAAK,CAAC;AAC1B"}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/SAVR/lib/db.ts"],"sourcesContent":["import mysql from \"mysql2/promise\"\r\n\r\nconst pool = mysql.createPool({\r\n  host: process.env.MYSQL_HOST || \"localhost\",\r\n  user: process.env.MYSQL_USER || \"root\",\r\n  password: process.env.MYSQL_PASSWORD || \"\",\r\n  database: process.env.MYSQL_DATABASE || \"savr\",\r\n  port: Number(process.env.MYSQL_PORT || 3306),\r\n  waitForConnections: true,\r\n  connectionLimit: 10,\r\n  queueLimit: 0,\r\n})\r\n\r\nexport async function executeQuery(query: string, values?: any[]) {\r\n  try {\r\n    const connection = await pool.getConnection()\r\n    const [results] = await connection.execute(query, values)\r\n    connection.release()\r\n    return results\r\n  } catch (error) {\r\n    console.error(\"Database error:\", error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport default pool\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;IAChC,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;IAChC,UAAU,QAAQ,GAAG,CAAC,cAAc,IAAI;IACxC,UAAU,QAAQ,GAAG,CAAC,cAAc,IAAI;IACxC,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;IACvC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEO,eAAe,aAAa,KAAa,EAAE,MAAc;IAC9D,IAAI;QACF,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,OAAO,CAAC,OAAO;QAClD,WAAW,OAAO;QAClB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,MAAM;IACR;AACF;uCAEe"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/SAVR/app/api/transactions/%5Bid%5D/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\r\nimport { verifyToken, getAuthToken } from \"@/lib/auth\"\r\nimport { executeQuery } from \"@/lib/db\"\r\n\r\nexport async function PUT(request: NextRequest, context: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const token = getAuthToken(request)\r\n    if (!token) {\r\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const decoded = verifyToken(token)\r\n    if (!decoded) {\r\n      return NextResponse.json({ message: \"Invalid token\" }, { status: 401 })\r\n    }\r\n\r\n    const { params } = await context\r\n    const { id } = params\r\n    if (!id) {\r\n      return NextResponse.json({ message: \"Transaction ID missing\" }, { status: 400 })\r\n    }\r\n    const transactionId = Number.parseInt(id)\r\n\r\n    if (!Number.isFinite(transactionId)) {\r\n      return NextResponse.json({ message: \"Invalid transaction id\" }, { status: 400 })\r\n    }\r\n    const { amount, type, date, note, categoryId } = await request.json()\r\n\r\n    const userId = decoded.userId\r\n\r\n    // Verify ownership\r\n    const transactions = await executeQuery(\r\n      \"SELECT id FROM transactions WHERE id = ? AND user_id = ?\",\r\n      [transactionId, userId],\r\n    )\r\n\r\n    if ((transactions as any[]).length === 0) {\r\n      return NextResponse.json({ message: \"Transaction not found\" }, { status: 404 })\r\n    }\r\n\r\n    await executeQuery(\r\n      \"UPDATE transactions SET amount = ?, type = ?, date = ?, note = ?, category_id = ? WHERE id = ?\",\r\n      [amount, type, date, note || null, categoryId || null, transactionId],\r\n    )\r\n\r\n    return NextResponse.json({ message: \"Transaction updated\" })\r\n  } catch (error) {\r\n    console.error(\"[v0] Update transaction error:\", error)\r\n    return NextResponse.json({ message: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function PATCH(request: NextRequest, context: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const token = getAuthToken(request)\r\n    if (!token) {\r\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const decoded = verifyToken(token)\r\n    if (!decoded) {\r\n      return NextResponse.json({ message: \"Invalid token\" }, { status: 401 })\r\n    }\r\n\r\n    const { params } = context\r\n    const { id } = await params\r\n    if (!id) {\r\n      return NextResponse.json({ message: \"Transaction ID missing\" }, { status: 400 })\r\n    }\r\n    const transactionId = Number.parseInt(id)\r\n    if (!Number.isFinite(transactionId)) {\r\n      return NextResponse.json({ message: \"Invalid transaction id\" }, { status: 400 })\r\n    }\r\n    const { amount, type, date, note, categoryId } = await request.json()\r\n\r\n    const userId = decoded.userId\r\n\r\n    // Verify ownership\r\n    const transactions = await executeQuery(\"SELECT id FROM transactions WHERE id = ? AND user_id = ?\", [\r\n      transactionId,\r\n      userId,\r\n    ])\r\n\r\n    if ((transactions as any[]).length === 0) {\r\n      return NextResponse.json({ message: \"Transaction not found\" }, { status: 404 })\r\n    }\r\n\r\n    const fields: string[] = []\r\n    const values: any[] = []\r\n\r\n    if (body.amount !== undefined) {\r\n      fields.push(\"amount = ?\")\r\n      values.push(Number.parseFloat(body.amount))\r\n    }\r\n    if (body.type !== undefined) {\r\n      fields.push(\"type = ?\")\r\n      values.push(body.type)\r\n    }\r\n    if (body.date !== undefined) {\r\n      fields.push(\"date = ?\")\r\n      values.push(body.date)\r\n    }\r\n    if (body.note !== undefined) {\r\n      fields.push(\"note = ?\")\r\n      values.push(body.note)\r\n    }\r\n    if (body.categoryId !== undefined || body.category !== undefined) {\r\n      // accept either categoryId or category name\r\n      if (body.categoryId !== undefined) {\r\n        fields.push(\"category_id = ?\")\r\n        values.push(body.categoryId)\r\n      } else if (body.category !== undefined) {\r\n        const cat = await executeQuery(\r\n          \"SELECT id FROM categories WHERE name = ? AND (user_id = ? OR user_id IS NULL)\",\r\n          [body.category, userId],\r\n        )\r\n        const categoryId = Array.isArray(cat) && cat[0] ? (cat[0] as any).id : null\r\n        fields.push(\"category_id = ?\")\r\n        values.push(categoryId)\r\n      }\r\n    }\r\n\r\n    if (fields.length === 0) return NextResponse.json({ message: \"No fields to update\" }, { status: 400 })\r\n\r\n    values.push(transactionId)\r\n    const updateQuery = `UPDATE transactions SET ${fields.join(\", \")} WHERE id = ?`\r\n    await executeQuery(updateQuery, values)\r\n\r\n    return NextResponse.json({ message: \"Transaction updated\" })\r\n  } catch (error) {\r\n    console.error(\"[v0] Patch transaction error:\", error)\r\n    return NextResponse.json({ message: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest, context: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const token = getAuthToken(request)\r\n    if (!token) {\r\n      return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const decoded = verifyToken(token)\r\n    if (!decoded) {\r\n      return NextResponse.json({ message: \"Invalid token\" }, { status: 401 })\r\n    }\r\n\r\n    const { params } = context\r\n    const { id } = await params\r\n    if (!id) {\r\n      return NextResponse.json({ message: \"Transaction ID missing\" }, { status: 400 })\r\n    }\r\n    const transactionId = Number.parseInt(id)\r\n    if (!Number.isFinite(transactionId)) {\r\n      return NextResponse.json({ message: \"Invalid transaction id\" }, { status: 400 })\r\n    }\r\n\r\n    const userId = decoded.userId\r\n\r\n    // Verify ownership\r\n    const transactions = await executeQuery(\"SELECT id FROM transactions WHERE id = ? AND user_id = ?\", [\r\n      transactionId,\r\n      userId,\r\n    ])\r\n\r\n    if ((transactions as any[]).length === 0) {\r\n      return NextResponse.json({ message: \"Transaction not found\" }, { status: 404 })\r\n    }\r\n\r\n    await executeQuery(\"DELETE FROM transactions WHERE id = ?\", [transactionId])\r\n\r\n    return NextResponse.json({ message: \"Transaction deleted\" })\r\n  } catch (error) {\r\n    console.error(\"[v0] Delete transaction error:\", error)\r\n    return NextResponse.json({ message: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}